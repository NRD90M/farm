var a=new getApp;Page({data:{integralData:[],page:1},onLoad:function(t){var e=this,i=a.siteInfo.uniacid,n=wx.getStorageSync("kejia_farm_uid");a.util.request({url:"entry/wxapp/integral",data:{op:"getIntegralRecord",uid:n,uniacid:i},success:function(a){e.setData({integralData:a.data.orderData})}}),a.util.setNavColor(i)},onReachBottom:function(t){var e=this,i=a.siteInfo.uniacid,n=wx.getStorageSync("kejia_farm_uid"),r=e.data.page,d=e.data.integralData;a.util.request({url:"entry/wxapp/integral",data:{op:"getIntegralRecord",uid:n,uniacid:i,page:r},success:function(a){if(a.data.orderData){for(var t=a.data.orderData,i=0;i<t.length;i++)d.push(t[i]);e.setData({integralData:d,page:parseInt(r)+1})}}})},pay:function(t){var e=t.currentTarget.dataset.orderid,i=a.siteInfo.uniacid,n=wx.getStorageSync("kejia_farm_uid");a.util.request({url:"entry/wxapp/integralPay",data:{orderid:e,uniacid:i},cachetime:"0",success:function(t){if(t.data&&t.data.data&&!t.data.errno){var r=t.data.data.package;wx.requestPayment({timeStamp:t.data.data.timeStamp,nonceStr:t.data.data.nonceStr,package:t.data.data.package,signType:"MD5",paySign:t.data.data.paySign,success:function(t){a.util.request({url:"entry/wxapp/integral",data:{op:"notify",order_id:e,uniacid:i,prepay_id:r,uid:n},success:function(a){wx.showToast({title:"支付成功",success:function(a){wx.redirectTo({url:"../orderList/index"})}})}})},fail:function(a){wx.redirectTo({url:"../orderList/index"})}})}else wx.redirectTo({url:"../orderList/index"})},fail:function(a){wx.showModal({title:"系统提示",content:a.data.message?a.data.message:"错误",showCancel:!1,success:function(a){a.confirm&&wx.redirectTo({url:"../../orderList/index"})}})}})},onShareAppMessage:function(){}}); 
