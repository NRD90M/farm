var t=new getApp,a=t.siteInfo.uniacid;Page({data:{height:0,currentList:{},isShow:!1,animation1:{},animation2:{},animation3:{},animation4:{},landMine:[],currentDeviceInfo:[],farmSetData:[],isLoading:!1,countDownNum:30,close_type:0,bottom:0,icon:[],is_data:!0},onLoad:function(e){var i=this,n=wx.getStorageSync("kejia_farm_uid");n?(t.util.request({url:"entry/wxapp/class",data:{op:"getControlAllLand",uniacid:a,uid:n,control:"control"},success:function(t){var a=!0;t.data.landMine.length>0?(a=!0,i.setData({landMine:t.data.landMine,currentList:t.data.landMine[0],icon:t.data.icon,is_data:a}),i.createAnimations()):a=!1,i.setData({is_data:a})}}),wx.getSystemInfo({success:function(t){var a=t.windowHeight-40;i.setData({height:a})}})):wx.navigateTo({url:"../../../login/index"});var o=0;t.globalData.sysData.model.indexOf("iPhone X")>-1&&(o=68),i.setData({farmSetData:wx.getStorageSync("kejia_farm_setData"),bottom:o})},createAnimations:function(){var t=wx.createAnimation({transformOrigin:"50% 50%",duration:1e3,timingFunction:"ease",delay:0}),a=wx.createAnimation({transformOrigin:"50% 50%",duration:1e3,timingFunction:"ease",delay:0}),e=wx.createAnimation({transformOrigin:"50% 50%",duration:1e3,timingFunction:"ease",delay:0}),i=wx.createAnimation({transformOrigin:"50% 50%",duration:1e3,timingFunction:"ease",delay:0});if(1==this.data.farmSetData.is_open_webthing&&this.data.currentList.currentDeviceInfo&&(t.width(this.data.currentList.currentDeviceInfo.watering+"%").step({duration:1e3}),a.width(this.data.currentList.currentDeviceInfo.temp/60*100+"%").step({duration:1e3}),e.width((this.data.currentList.currentDeviceInfo.co2-350)/650*100+"%").step({duration:1e3}),i.width(this.data.currentList.currentDeviceInfo.illumination/1e3+"%").step({duration:1e3}),this.setData({animation1:t.export(),animation2:a.export(),animation3:e.export(),animation4:i.export()})),2==this.data.farmSetData.is_open_webthing&&this.data.currentList.device){var n=this.data.currentList.device;n.temp&&(t.width(n.temp.DevHumiValue+"%").step({duration:1e3}),a.width(n.temp.DevTempValue/60*100+"%").step({duration:1e3})),n.co2&&e.width((n.co2.DevHumiValue-350)/650*100+"%").step({duration:1e3}),n.light&&i.width(n.light.DevHumiValue/10+"%").step({duration:1e3}),this.setData({animation1:t.export(),animation2:a.export(),animation3:e.export(),animation4:i.export()})}},chooseItem:function(t){var a=this,e=this,i=t.currentTarget.dataset.id,n="";this.data.landMine.map(function(t){t.id===i&&(a.setData({currentList:t,isShow:!1}),n=t.device_num,e.createAnimations())})},select:function(){this.setData({isShow:!0})},close:function(){this.setData({isShow:!1})},gotoBuy:function(t){wx.navigateTo({url:"../../../land/landList/index"})},watering:function(a){var e=this,i=e.data.currentList;if(i.device_num){var n=wx.getStorageSync("kejia_farm_uid"),o=t.siteInfo.uniacid,r=a.detail.formId;t.util.request({url:"entry/wxapp/class",data:{control:"control",op:"watering",uniacid:o,uid:n,lid:i.id,web_did:i.device_num,formId:r},success:function(t){1==t.data.code?(e.setData({close_type:1}),e.countDown(i.device_num,1)):wx.showModal({title:"提示",content:t.data.msg,showCancel:!1})}})}else wx.showModal({title:"提示",content:"当前土地未绑定设备",showCancel:!1})},fertilization:function(a){var e=this,i=e.data.currentList;if(i.device_num){var n=wx.getStorageSync("kejia_farm_uid"),o=t.siteInfo.uniacid,r=a.detail.formId;t.util.request({url:"entry/wxapp/class",data:{op:"fertilization",control:"control",uniacid:o,uid:n,lid:i.id,web_did:i.device_num,formId:r},success:function(t){1==t.data.code?(e.setData({close_type:2}),e.countDown(i.device_num,2)):wx.showModal({title:"提示",content:t.data.msg,showCancel:!1})}})}else wx.showModal({title:"提示",content:"当前土地未绑定设备",showCancel:!1})},killVer:function(a){var e=this,i=e.data.currentList,n=wx.getStorageSync("kejia_farm_uid"),o=t.siteInfo.uniacid,r=a.detail.formId;t.util.request({url:"entry/wxapp/class",data:{op:"killVer",control:"control",uniacid:o,uid:n,lid:i.id,web_did:i.device_num,formId:r},success:function(t){1==t.data.code?(e.setData({close_type:3}),e.countDown(i.device_num,3)):wx.showModal({title:"提示",content:t.data.msg,showCancel:!1})}})},weeding:function(a){var e=this.data.currentList,i=wx.getStorageSync("kejia_farm_uid"),n=t.siteInfo.uniacid,o=a.detail.formId;t.util.request({url:"entry/wxapp/class",data:{op:"weeding",control:"control",uniacid:n,uid:i,lid:e.id,formId:o},success:function(t){wx.showModal({title:"提示",content:t.data.msg,showCancel:!1})}})},countDown:function(t,a){var e=this,i=30;e.setData({isLoading:!0,countDownNum:30}),e.setData({timer:setInterval(function(){i--,e.setData({countDownNum:i}),0==i&&(clearInterval(e.data.timer),e.setData({isLoading:!1}),e.closeDevice(t,a))},1e3)})},closeDevice:function(a,e){var i=this,n=t.siteInfo.uniacid,o=wx.getStorageSync("kejia_farm_uid");t.util.request({url:"entry/wxapp/class",data:{op:"closeDevice",control:"control",web_did:a,close_type:e,uniacid:n,uid:o},success:function(t){wx.showModal({title:"提示",content:t.data.msg,showCancel:!1}),i.setData({close_type:0})}})},onUnload:function(t){var a=this,e=this.data.close_type,i=a.data.currentList;if(1==e||2==e||3==e){var n=i.device_num;a.closeDevice(n,e),clearInterval(a.data.timer)}}}); 
