var e=new getApp;Page({data:{selectedSeed:[],seeds:[],area:0,hidden:!0,lid:"",mineLand:[],farmSetData:[],icon:[]},onLoad:function(a){var t=this,d=e.siteInfo.uniacid,s=a.lid,n=wx.getStorageSync("kejia_farm_uid");e.util.request({url:"entry/wxapp/land",data:{op:"getSendList",uniacid:d,lid:s,uid:n},success:function(e){wx.getStorage({key:"seeds",success:function(a){var d=JSON.parse(a.data),s=e.data.send;s.map(function(e){d.map(function(a){e.id==a.id&&(e.selected=!0)})}),t.setData({selectedSeed:d,seeds:s})},fail:function(){t.setData({seeds:e.data.send})}}),t.setData({lid:s,mineLand:e.data.mineLand,area:e.data.mineLand.count-e.data.mineLand.can_seed_count,icon:e.data.icon})}}),t.setData({farmSetData:wx.getStorageSync("kejia_farm_setData")}),e.util.setNavColor(d)},checked:function(e){var a=this,t=e.currentTarget.dataset.id,d=0;a.data.selectedSeed.map(function(e){d=e.num+d}),a.data.area>d?a.data.seeds.map(function(e){if(e.id==t)if(e.selected=!0,0==a.data.selectedSeed.length)a.data.selectedSeed.push(e);else{var d=!1;a.data.selectedSeed.map(function(e,a){e.id==t&&(e.num+=1,d=!0)}),d||a.data.selectedSeed.push(e)}}):a.setData({hidden:!1}),a.sumPrice()},deletes:function(e){var a=this,t=e.currentTarget.dataset.id;a.data.seeds.map(function(e,d){e.id==t&&(a.data.seeds.splice(d,1),a.setData({seeds:a.data.seeds}))}),a.data.selectedSeed.length>0&&a.data.selectedSeed.map(function(e,d){e.id==t&&(a.data.selectedSeed.splice(d,1),a.setData({selectedSeed:a.data.selectedSeed}))})},deleteSelect:function(e){var a=this,t=e.currentTarget.dataset.id;a.data.selectedSeed.map(function(e,d){e.id==t&&(e.num-=1,0==e.num&&(a.data.selectedSeed.splice(d,1),a.data.seeds.map(function(e){e.id==t&&(e.selected=!1,a.setData({seeds:a.data.seeds}))})),a.setData({selectedSeed:a.data.selectedSeed}))}),a.sumPrice()},submits:function(){var e=JSON.stringify(this.data.selectedSeed);wx.setStorage({key:"seeds",data:e,success:function(e){wx.navigateBack({delta:1})}})},View:function(e){var a=e.currentTarget.dataset.sid;wx.navigateTo({url:"../../land/seedDetails/index?sid="+a})},cancel:function(){this.setData({hidden:!0})},sumPrice:function(){var e=this;e.data.selectedSeed.map(function(e){e.totalPrice=(e.num*e.price).toFixed(2)}),e.setData({seeds:e.data.seeds,selectedSeed:e.data.selectedSeed})}}); 
