var t=new getApp,a=t.siteInfo.uniacid;Page({data:{plate:1,mineid:"",landDetail:[],adoptid:"",farmSetData:[],landData:[],landSpec:[],is_show_estimate_dialog:!1,is_show_sure_dialog:!1,seed_id:"",adoptData:[]},onLoad:function(e){t.util.setNavColor(a);var s=this,i=e.plate;if(1==i){var d=e.mineid;s.getLandDetail(d)}else{var n=e.adoptid;s.getAnimalDetail(n)}s.setData({farmSetData:wx.getStorageSync("kejia_farm_setData"),plate:i})},getLandDetail:function(e){var s=this;t.util.request({url:"entry/wxapp/class",data:{op:"getLandDetail",action:"land",control:"seller",mineid:e,uniacid:a},success:function(t){s.setData({landDetail:t.data.landDetail,mineid:e,seedData:t.data.seedData,landData:t.data.landData,landSpec:t.data.landSpec})}})},getAnimalDetail:function(e){var s=this;t.util.request({url:"entry/wxapp/class",data:{op:"getAnimalDetail",action:"adopt",control:"seller",adoptid:e,uniacid:a},success:function(t){s.setData({adoptData:t.data.adoptData,adoptid:e,animalOrder:t.data.orderData})}})},releases:function(t){var a=this.data.plate;if(1==a){var e=t.currentTarget.dataset.seedid;wx.navigateTo({url:"../release/index?lid="+this.data.landDetail.id+"&plate="+a+"&seed_id="+e})}else{var s=t.currentTarget.dataset.adoptid;wx.navigateTo({url:"../release/index?adoptid="+s+"&plate="+a})}},seedMature:function(t){var a="";this.data.is_show_estimate_dialog||(a=t.currentTarget.dataset.seedid),this.setData({is_show_estimate_dialog:!this.data.is_show_estimate_dialog,seed_id:a})},seedEstimate:function(e){var s=this,i=this.data.seed_id,d=e.detail.value.sale_price,n=e.detail.value.weight,o=e.currentTarget.dataset.status;return n<=0||!n?(wx.showModal({title:"提示",content:"重量必须大于0",showCancel:!1}),!1):d<=0||!d?(wx.showModal({title:"提示",content:"售出单价必须大于0",showCancel:!1}),!1):void t.util.request({url:"entry/wxapp/class",data:{op:"seedEstimate",action:"land",control:"seller",id:i,uniacid:a,sale_price:d,weight:n,status:o},success:function(t){console.log(t),wx.showModal({title:"提示",content:t.data.msg,showCancel:!1,success:function(){0==t.data.code&&(s.getLandDetail(s.data.mineid),1==o?s.setData({is_show_estimate_dialog:!s.data.is_show_estimate_dialog}):s.setData({is_show_sure_dialog:!s.data.is_show_sure_dialog}))}})}})},seedPick:function(t){var a="";this.data.is_show_estimate_dialog||(a=t.currentTarget.dataset.seedid),this.setData({is_show_sure_dialog:!this.data.is_show_sure_dialog,seed_id:a})},gainSeed:function(e){var s=this,i=this.data.seed_id,d=e.detail.value.sale_price,n=e.detail.value.weight,o=e.currentTarget.dataset.status;return n<=0||!n?(wx.showModal({title:"提示",content:"重量必须大于0",showCancel:!1}),!1):d<=0||!d?(wx.showModal({title:"提示",content:"售出单价必须大于0",showCancel:!1}),!1):void t.util.request({url:"entry/wxapp/class",data:{op:"gainSeed",action:"land",control:"seller",id:i,uniacid:a,sale_price:d,weight:n,status:o},success:function(t){console.log(t),wx.showModal({title:"提示",content:t.data.msg,showCancel:!1,success:function(){0==t.data.code&&(s.getLandDetail(s.data.mineid),1==o?s.setData({is_show_estimate_dialog:!s.data.is_show_estimate_dialog}):s.setData({is_show_sure_dialog:!s.data.is_show_sure_dialog}))}})}})},sendTemplateToUser:function(e){var s=e.currentTarget.dataset.seedid,i=e.currentTarget.dataset.statustxt;wx.showModal({title:"提示",content:"确认要发送模板消息通知用户当前种植状态为"+i+"吗？",success:function(e){e.confirm&&t.util.request({url:"entry/wxapp/class",data:{op:"sendTemplateToUser",action:"land",control:"seller",id:s,currentStatus:i,uniacid:a},success:function(t){wx.showToast({title:t.data.msg,icon:"none"})}})}})},sendAdoptTemplateToUser:function(e){var s=e.currentTarget.dataset.adoptid,i=e.currentTarget.dataset.statustxt;wx.showModal({title:"提示",content:"确认要发送模板消息通知用户当前认养状态为"+i+"吗？",success:function(e){e.confirm&&t.util.request({url:"entry/wxapp/class",data:{op:"sendTemplateToUser",action:"adopt",control:"seller",id:s,currentStatus:i,uniacid:a},success:function(t){wx.showToast({title:t.data.msg,icon:"none"})}})}})},changeSeedStstua:function(a){var e=this,s=a.currentTarget.dataset.seedid,i=a.currentTarget.dataset.status,d=a.currentTarget.dataset.statustxt;wx.showModal({title:"提示",content:"确认修改种植状态为"+d+"吗？",success:function(a){a.confirm&&t.util.request({url:"entry/wxapp/class",data:{op:"changeSeedStstua",action:"land",control:"seller",id:s,status:i,success:function(t){wx.showModal({title:"提示",content:t.data.msg,showCancel:!1,success:function(){0==t.data.code&&e.getLandDetail(mineid)}})}}})}})},changeAdoptStstua:function(e){var s=this,i=e.currentTarget.dataset.adoptid,d=e.currentTarget.dataset.statustxt,n=e.currentTarget.dataset.status;wx.showModal({title:"提示",content:"确认修改认养状态为"+d+"吗？",success:function(e){e.confirm&&t.util.request({url:"entry/wxapp/class",data:{op:"changeAdoptStatus",action:"adopt",control:"seller",adopt_id:i,currentStatus:d,status:n,uniacid:a},success:function(t){console.log(t),wx.showModal({title:"提示",content:t.data.msg,success:function(){0==t.data.code&&s.getAnimalDetail(s.data.adoptid)}})}})}})},updateAdoptNumber:function(e){var s=e.detail.value,i=e.currentTarget.dataset.adoptid;wx.showModal({title:"提示",content:"确认要修改认养编号为"+s+"吗？",success:function(e){e.confirm&&t.util.request({url:"entry/wxapp/class",data:{op:"udpateAdoptNumber",action:"adopt",control:"seller",adopt_id:i,adopt_number:s,uniacid:a},success:function(t){wx.showToast({title:t.data.msg,icon:"none"})}})}})}}); 
