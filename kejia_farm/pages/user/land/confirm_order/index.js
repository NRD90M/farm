var e=new getApp;Page({data:{borderImg:"../../../../images/icon/address-line.png",address:"",name:"",phone:"",seedData:[],seed_id:[],farmSetData:[],mine_land_id:""},onLoad:function(a){var t=this,d=a.seed_id,i=a.mine_land_id,n=e.siteInfo.uniacid,s=wx.getStorageSync("kejia_farm_uid");e.util.request({url:"entry/wxapp/seed",data:{op:"getSureOrder",uniacid:n,seed_id:d,uid:s},success:function(e){t.setData({seedData:e.data.seedData,seed_id:d,mine_land_id:i})}}),e.util.setNavColor(n),t.setData({farmSetData:wx.getStorageSync("kejia_farm_setData")})},selAddress:function(e){var a=this;wx.chooseAddress({success:function(e){a.setData({address:e.provinceName+e.cityName+e.countyName+e.detailInfo,name:e.userName,phone:e.telNumber})}})},nowPay:function(a){var t=this,d=t.data.name,i=t.data.address,n=t.data.phone,s=wx.getStorageSync("kejia_farm_uid"),r=e.siteInfo.uniacid,o=t.data.seed_id,c=t.data.mine_land_id;if(""==i||""==d||""==n)wx.showToast({title:"请选择收货地址"});else{var u={op:"addOrder",address:i,name:d,phone:n,uniacid:r,seed_id:o,uid:s,mine_land_id:c};e.util.request({url:"entry/wxapp/seed",data:u,success:function(a){var t=a.data.order_id;e.util.request({url:"entry/wxapp/SeedSendPay",data:{orderid:t,uniacid:r},cachetime:"0",success:function(a){if(a.data&&a.data.data&&!a.data.errno){var d=a.data.data.package;wx.requestPayment({timeStamp:a.data.data.timeStamp,nonceStr:a.data.data.nonceStr,package:a.data.data.package,signType:"MD5",paySign:a.data.data.paySign,success:function(a){e.util.request({url:"entry/wxapp/seed",data:{op:"notify_send",order_id:t,uniacid:r,prepay_id:d,seed_id:o},success:function(e){wx.showToast({title:"支付成功",success:function(e){wx.redirectTo({url:"../../../shop/orderList/index"})}})}})},fail:function(e){wx.redirectTo({url:"../../../shop/orderList/index"})}})}else wx.redirectTo({url:"../../../shop/orderList/index"})},fail:function(e){wx.showModal({title:"系统提示",content:e.data.message?e.data.message:"错误",showCancel:!1,success:function(e){e.confirm&&wx.redirectTo({url:"../../../shop/orderList/index"})}})}})}})}}}); 
